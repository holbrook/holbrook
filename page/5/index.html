<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="qnMTU0bmBQ">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"holbrook.github.io","root":"/","scheme":"Gemini","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-2}},"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="心内求法">
<meta property="og:url" content="http://holbrook.github.io/page/5/index.html">
<meta property="og:site_name" content="心内求法">
<meta property="article:author" content="Holbrook">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://holbrook.github.io/page/5/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>心内求法</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8cdb29fdf281f4429a98d7b5d0e0d4a8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">心内求法</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Holbrook的个人博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Holbrook</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content index posts-expand">
          
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2015/05/04/modern_web_dev_env.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/05/04/modern_web_dev_env.html" class="post-title-link" itemprop="url">搭建一个“现代化”的web开发环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2015-05-04T00:00:00+08:00">2015-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">软件技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用yoeman, bower, grunt等工具开发web。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2015/05/04/modern_web_dev_env.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/04/29/cm_tools_via_salt.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/04/29/cm_tools_via_salt.html" class="post-title-link" itemprop="url">基于salt开发配置管理工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-04-29 00:00:00" itemprop="dateCreated datePublished" datetime="2014-04-29T00:00:00+08:00">2014-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD/" itemprop="url" rel="index"><span itemprop="name">软件基础设施</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>T2，是某厂商开发的ESB产品，用于证券公司交易相关系统之间的互相调用。该产品的设计思路是一套核心的组件实现消息通信，<br>通过不同的插件实现ESB的协议转换、消息路由、访问控制等功能。每个节点基于xml配置不同的插件，即可扮演不同的角色。</p>
<p>恰恰由于这种灵活性，导致其配置非常复杂，人工进行配置修改和检查很容易出错。再加上每个架构角色可能会有多个节点，重复性的工作让人厌烦。</p>
<p>为此，我想通过salt进行自动化的配置。主要需求如下：</p>
<ul>
<li>只定义最基本的、非冗余的数据，从这些数据生成所有的配置</li>
<li>支持多个版本的部署</li>
<li>自动实现停止服务、部署、启动服务等一系列操作</li>
<li>支持升级包的部署</li>
</ul>
<h1 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h1><p>salt适合固定的配置(state)部署多个实例(minion)的场景。尽管可以在pillar、state中使用python脚本，但仍无法满足本场景中需要的复杂度。<br>所以拟构建python应用，通过salt client API与salt master进行交互。</p>
<p>为了降低对使用者的要求，需要实现一个web界面。拟采用bottle.py。<br>。</p>
<h1 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h1><p>salt的“三驾马车”是 <code>state</code> 、 <code>pillar</code> 、 <code>grains</code> 。其中：</p>
<ul>
<li>state是配置项(CI)的集合。配置项即可以是固定的内容，也可以是模板+数据，还可以是命令和脚本</li>
<li>pillar中定义数据并分配给minion。这些数据可以用于state中模板的上下文(context)数据</li>
<li>grains记录minion自身的属性。可以作为为minion分配pillar和state的依据，也可以用于模板的上下文</li>
</ul>
<p>针对本文提到的场景，关系如下：</p>
<ul>
<li>CI<br>在svn中维护各个版本的所有配置项</li>
<li>datas<br>在文件中维护部署需要的数据</li>
<li>pillars.top<br>根据datas和各节点的grains数据，组合出每个minion的pillars</li>
<li>states.top<br>根据各节点的grains和pillars数据，将CI分配到minion</li>
<li>pillars<br>节点数据，其中可以引用grains</li>
<li>states<br>节点状态，其中可以引用grains, pillars</li>
</ul>
<h2 id="pillar-roots目录结构"><a href="#pillar-roots目录结构" class="headerlink" title="pillar_roots目录结构"></a>pillar_roots目录结构</h2><p>`pillar<del>roots</del>` 是 `/etc/salt/master`<br>中配置的参数，指定所有可用pillar的保存位置。<br>salt中可以按照环境划分不同的pillars，比如 `base` ， `dev` , `prod`<br>等, 还可以指定多个pillar, 比如 `ext<del>pillar</del>` 。</p>
<p>本文的场景中，不需要在salt中区分各种环境，故只使用 `base`<br>目录。其默认值为 <code>/srv/pillar</code> 。设计的目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;srv&#x2F;pillar</span><br><span class="line"> ├─ dev.yaml</span><br><span class="line"> ├─ uat.yaml</span><br><span class="line"> ├─ prod.yaml</span><br><span class="line"> ├─ xxx.yaml</span><br><span class="line"> └─ top.sls</span><br></pre></td></tr></table></figure>

<p>其中，yaml是部署配置，通过工具编辑； top.sls是pillar分配，通过脚本生成。</p>
<h2 id="file-root目录结构"><a href="#file-root目录结构" class="headerlink" title="file_root目录结构"></a>file_root目录结构</h2><p><code>file_root</code> 是 <code>/etc/salt/master</code><br>中配置的参数，指定所有可用state的保存位置。<br>salt中可以按照环境划分不同的states，比如 <code>base</code> ， <code>dev</code> , <code>prod</code> 等。</p>
<p>本文的场景中，不需要在salt中区分各种环境，故只使用 <code>base</code><br>目录。其默认值为 <code>/srv/salt</code> 。设计的目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;srv&#x2F;salt</span><br><span class="line"> ├─ v0.1&#x2F;</span><br><span class="line"> │ ├─ config items&#x2F;     配置项，可能是多个目录</span><br><span class="line"> │ └─ states&#x2F;           salt state定义。会引用上面的 config item。</span><br><span class="line"> ├─ v1.0&#x2F;</span><br><span class="line"> ├─ v1.0.1&#x2F;</span><br><span class="line"> ├─ vx.x.x&#x2F;</span><br><span class="line"> └─ top.sls             状态分配，通过脚本生成</span><br></pre></td></tr></table></figure>

<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><ol>
<li>从svn中获取需要的各个版本，放入 <code>/srv/salt/</code></li>
<li>编辑 <code>/srv/pillar</code> 中的各个部署配置</li>
<li>生成 <code>/srv/pillar/top.sls</code> 和 <code>/srv/salt/top.sls</code></li>
<li>调用salt client API进行部署</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/04/24/cm_features.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/04/24/cm_features.html" class="post-title-link" itemprop="url">配置管理规范需要考虑的内容</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-04-24 00:00:00" itemprop="dateCreated datePublished" datetime="2014-04-24T00:00:00+08:00">2014-04-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">软件工程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在拟定《配置管理规范》时，需要考虑很多因素。本文例举一些需要考虑的因素以及相关的可选策略。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2014/04/24/cm_features.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/03/10/fuse_develop_adapter.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/10/fuse_develop_adapter.html" class="post-title-link" itemprop="url">开发Camel组件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-03-10 00:00:00" itemprop="dateCreated datePublished" datetime="2014-03-10T00:00:00+08:00">2014-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">软件技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><p>因为 <a href="/2014/01/20/about_fuse_esb.html" title="JBOSS FUSE:你必须知道的那些事">JBOSS FUSE:你必须知道的那些事</a> ，而ServiceMix的核心组成部分是Apache Camel，所以“用Fuse开发路由”也就是“开发Camel路由”。</p>
<p><a href="http://search.maven.org/#search%7Cga%7C1%7Corg.apache.camel.archetypes" target="_blank" rel="noopener">Camel提供了大量的开发</a>工具，其中<a href="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22camel-archetype-blueprint%22" target="_blank" rel="noopener">camel-archetype-blueprint</a> 是一个<a href="http://maven.apache.org/guides/introduction/introduction-to-archetypes.html" target="_blank" rel="noopener">maven<br>archetype</a>，可以基于 <a href="/2014/01/22/osgi_blueprint_container.html" title="Blueprint">Blueprint</a>，以依赖注入的方式配置CamelContext。下面快速创建一个demo:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate  \</span><br><span class="line">-DarchetypeGroupId&#x3D;org.apache.camel.archetypes \</span><br><span class="line">-DarchetypeArtifactId&#x3D;camel-archetype-blueprint \</span><br><span class="line">-DarchetypeVersion&#x3D;2.12.2 \</span><br><span class="line">-DgroupId&#x3D;thinkinside.demo.fuse \</span><br><span class="line">-DartifactId&#x3D;route-demo \</span><br><span class="line">-Dversion&#x3D;1.0.0-SNAPSHOT</span><br></pre></td></tr></table></figure>

<p>会创建如下结构的一个工程：</p>
<img src="/2014/03/10/fuse_develop_adapter/route-demo-structure.png" class="">

<p>从 <code>pom.xml</code>来看，这是一个 <a href="/2014/01/21/tycho_vs_maven_bundle_plugin.html" title="使用maven-bundle-plugin构建的OSGibundle工程">使用maven-bundle-plugin构建的OSGibundle工程</a></p>
<h1 id="基于Blueprint装配Camel"><a href="#基于Blueprint装配Camel" class="headerlink" title="基于Blueprint装配Camel"></a>基于Blueprint装配Camel</h1><p>工程的`META-INF/blueprint/blueprint.xml’文件是一个Blueprint配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;blueprint xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.osgi.org&#x2F;xmlns&#x2F;blueprint&#x2F;v1.0.0&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:camel&#x3D;&quot;http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;blueprint&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;</span><br><span class="line">       http:&#x2F;&#x2F;www.osgi.org&#x2F;xmlns&#x2F;blueprint&#x2F;v1.0.0 http:&#x2F;&#x2F;www.osgi.org&#x2F;xmlns&#x2F;blueprint&#x2F;v1.0.0&#x2F;blueprint.xsd</span><br><span class="line">       http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;blueprint http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;blueprint&#x2F;camel-blueprint.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;bean id&#x3D;&quot;helloBean&quot; class&#x3D;&quot;thinkinside.demo.fuse.HelloBean&quot;&gt;</span><br><span class="line">      &lt;property name&#x3D;&quot;say&quot; value&#x3D;&quot;Hi from Camel&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">  &lt;camelContext id&#x3D;&quot;blueprintContext&quot; trace&#x3D;&quot;false&quot; xmlns&#x3D;&quot;http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;blueprint&quot;&gt;</span><br><span class="line">    &lt;route id&#x3D;&quot;timerToLog&quot;&gt;</span><br><span class="line">      &lt;from uri&#x3D;&quot;timer:foo?period&#x3D;5000&quot;&#x2F;&gt;</span><br><span class="line">      &lt;setBody&gt;</span><br><span class="line">          &lt;method ref&#x3D;&quot;helloBean&quot; method&#x3D;&quot;hello&quot;&#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;setBody&gt;</span><br><span class="line">      &lt;log message&#x3D;&quot;The message contains$&#123;body&#125;&quot;&#x2F;&gt;</span><br><span class="line">      &lt;to uri&#x3D;&quot;mock:result&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;route&gt;</span><br><span class="line">  &lt;&#x2F;camelContext&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;blueprint&gt;</span><br></pre></td></tr></table></figure>

<p>该配置文件中，定义了一个id为 <code>blueprintContext</code> 的Camel<br>Context。这个Context中定义了一个路由：</p>
<ol>
<li>入口为一个Timer类型的Endpoint</li>
<li>使用预定义的bean为Message设置body</li>
<li>记录日志</li>
<li>出口为一个Mock类型的Endpoint</li>
</ol>
<p>如果使用FuseIDE，可以看到图形化的配置界面：</p>
<img src="/2014/03/10/fuse_develop_adapter/route-design.png" class="">


<h1 id="部署到ServiceMix"><a href="#部署到ServiceMix" class="headerlink" title="部署到ServiceMix"></a>部署到ServiceMix</h1><p>执行 <code>mvn package</code> 后，得到 <code>route-demo-1.0.0-SNAPSHOT.jar</code><br>，这是一个OSGi bundle。可以将jar文件部署到</p>
<p><code>$SERVICEMIX_HOME/deploy/</code><br>目录中。正常情况下，bundle的依赖关系被满足，该bundle会被自动启动。</p>
<h1 id="从ServiceMix到Fuse"><a href="#从ServiceMix到Fuse" class="headerlink" title="从ServiceMix到Fuse"></a>从ServiceMix到Fuse</h1><p>上述的过程也适用于JBoss Fuse。</p>
<p>但是Fuse对ServiceMix进行了再次封装，需要使用Fuse对应的版本。比如，=camel-archetype-blueprint=<br>的版本可能要使用 <code>2.10.0.redhat-60024</code><br>这样的“Fuse版本号”，否则在部署到Fuse是可能会发生版本不匹配的问题。</p>
<p>Fuse提供了一个maven仓库，专门提供这种定制版本的组件，需要在maven中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;repository&gt;</span><br><span class="line">    &lt;id&gt;fusesource&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;repo.fusesource.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">    &lt;&#x2F;snapshots&gt;</span><br><span class="line">    &lt;releases&gt;</span><br><span class="line">         &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line">     &lt;&#x2F;releases&gt;</span><br><span class="line">&lt;&#x2F;repository&gt;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/03/04/ci_tools.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/04/ci_tools.html" class="post-title-link" itemprop="url">持续集成(CI)工具的作用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-03-04 00:00:00" itemprop="dateCreated datePublished" datetime="2014-03-04T00:00:00+08:00">2014-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">软件工程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="个人时代的软件开发"><a href="#个人时代的软件开发" class="headerlink" title="个人时代的软件开发"></a>个人时代的软件开发</h1><p>众所周知，软件开发一般需要编码、构建、测试、打包、发布等步骤，如下图：</p>
<div style="margin: 0.5em 0px; display: block!important; text-align: center"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="501pt" height="44pt"
 viewBox="0.00 0.00 500.51 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-40 496.5111,-40 496.5111,4 -4,4"/>
<!-- Code -->
<g id="node1" class="node">
<title>Code</title>
<ellipse fill="none" stroke="#000000" cx="31.4204" cy="-18" rx="31.341" ry="18"/>
<text text-anchor="middle" x="31.4204" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Code</text>
</g>
<!-- Build -->
<g id="node2" class="node">
<title>Build</title>
<ellipse fill="none" stroke="#000000" cx="131.3418" cy="-18" rx="32.502" ry="18"/>
<text text-anchor="middle" x="131.3418" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Build</text>
</g>
<!-- Code&#45;&gt;Build -->
<g id="edge1" class="edge">
<title>Code&#45;&gt;Build</title>
<path fill="none" stroke="#000000" d="M63.0361,-18C71.0845,-18 79.8704,-18 88.38,-18"/>
<polygon fill="#000000" stroke="#000000" points="88.5546,-21.5001 98.5546,-18 88.5546,-14.5001 88.5546,-21.5001"/>
</g>
<!-- Test -->
<g id="node3" class="node">
<title>Test</title>
<ellipse fill="none" stroke="#000000" cx="227.5047" cy="-18" rx="27.8248" ry="18"/>
<text text-anchor="middle" x="227.5047" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Test</text>
</g>
<!-- Build&#45;&gt;Test -->
<g id="edge2" class="edge">
<title>Build&#45;&gt;Test</title>
<path fill="none" stroke="#000000" d="M163.8981,-18C172.1879,-18 181.1674,-18 189.6947,-18"/>
<polygon fill="#000000" stroke="#000000" points="189.7952,-21.5001 199.7952,-18 189.7952,-14.5001 189.7952,-21.5001"/>
</g>
<!-- Package -->
<g id="node4" class="node">
<title>Package</title>
<ellipse fill="none" stroke="#000000" cx="334.3752" cy="-18" rx="43.4183" ry="18"/>
<text text-anchor="middle" x="334.3752" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Package</text>
</g>
<!-- Test&#45;&gt;Package -->
<g id="edge3" class="edge">
<title>Test&#45;&gt;Package</title>
<path fill="none" stroke="#000000" d="M255.3047,-18C263.1282,-18 271.9126,-18 280.7054,-18"/>
<polygon fill="#000000" stroke="#000000" points="280.9743,-21.5001 290.9743,-18 280.9742,-14.5001 280.9743,-21.5001"/>
</g>
<!-- Deploy -->
<g id="node5" class="node">
<title>Deploy</title>
<ellipse fill="none" stroke="#000000" cx="453.0475" cy="-18" rx="39.4273" ry="18"/>
<text text-anchor="middle" x="453.0475" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Deploy</text>
</g>
<!-- Package&#45;&gt;Deploy -->
<g id="edge4" class="edge">
<title>Package&#45;&gt;Deploy</title>
<path fill="none" stroke="#000000" d="M377.8905,-18C386.1676,-18 394.8877,-18 403.3401,-18"/>
<polygon fill="#000000" stroke="#000000" points="403.4695,-21.5001 413.4695,-18 403.4694,-14.5001 403.4695,-21.5001"/>
</g>
</g>
</svg>
</div>

<p>在“个人英雄”时代，一个人完成所有的事情，一切都不是问题。</p>
<h1 id="团队开发"><a href="#团队开发" class="headerlink" title="团队开发"></a>团队开发</h1><p>很快，软件的规模就上升到了个人无法完成的程度。这就需要团队开发。在团队开发模式中，一定要解决代码共享的问题:</p>
<div style="margin: 0.5em 0px; display: block!important; text-align: center"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="549pt" height="139pt"
 viewBox="0.00 0.00 548.79 139.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 135)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-135 544.7911,-135 544.7911,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_process</title>
<polygon fill="none" stroke="#000000" points="8,-46 8,-123 532.7911,-123 532.7911,-46 8,-46"/>
<text text-anchor="middle" x="270.3956" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#000000">开发过程</text>
</g>
<!-- Code -->
<g id="node1" class="node">
<title>Code</title>
<ellipse fill="none" stroke="#000000" cx="47.4204" cy="-72" rx="31.341" ry="18"/>
<text text-anchor="middle" x="47.4204" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Code</text>
</g>
<!-- Build -->
<g id="node2" class="node">
<title>Build</title>
<ellipse fill="none" stroke="#000000" cx="147.3418" cy="-72" rx="32.502" ry="18"/>
<text text-anchor="middle" x="147.3418" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Build</text>
</g>
<!-- Code&#45;&gt;Build -->
<g id="edge1" class="edge">
<title>Code&#45;&gt;Build</title>
<path fill="none" stroke="#000000" d="M79.0361,-72C87.0845,-72 95.8704,-72 104.38,-72"/>
<polygon fill="#000000" stroke="#000000" points="104.5546,-75.5001 114.5546,-72 104.5546,-68.5001 104.5546,-75.5001"/>
</g>
<!-- repo1 -->
<g id="node6" class="node">
<title>repo1</title>
<polygon fill="none" stroke="#000000" points="176.0568,-36 173.0568,-40 152.0568,-40 149.0568,-36 118.6268,-36 118.6268,0 176.0568,0 176.0568,-36"/>
<text text-anchor="middle" x="147.3418" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">代码库</text>
</g>
<!-- Code&#45;&gt;repo1 -->
<g id="edge5" class="edge">
<title>Code&#45;&gt;repo1</title>
<path fill="none" stroke="#000000" d="M70.5955,-59.4756C82.2124,-53.1975 96.5724,-45.437 109.7171,-38.3333"/>
<polygon fill="#000000" stroke="#000000" points="111.441,-41.3802 118.5744,-33.5466 108.1129,-35.2219 111.441,-41.3802"/>
</g>
<!-- Test -->
<g id="node3" class="node">
<title>Test</title>
<ellipse fill="none" stroke="#000000" cx="251.6447" cy="-72" rx="27.8248" ry="18"/>
<text text-anchor="middle" x="251.6447" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Test</text>
</g>
<!-- Build&#45;&gt;Test -->
<g id="edge2" class="edge">
<title>Build&#45;&gt;Test</title>
<path fill="none" stroke="#000000" d="M180.0577,-72C190.7424,-72 202.6973,-72 213.7313,-72"/>
<polygon fill="#000000" stroke="#000000" points="213.9566,-75.5001 223.9566,-72 213.9565,-68.5001 213.9566,-75.5001"/>
</g>
<!-- repo2 -->
<g id="node7" class="node">
<title>repo2</title>
<polygon fill="none" stroke="#000000" stroke-dasharray="5,2" points="287.2496,-36 284.2496,-40 263.2496,-40 260.2496,-36 216.0398,-36 216.0398,0 287.2496,0 287.2496,-36"/>
<text text-anchor="middle" x="251.6447" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">配置库</text>
</g>
<!-- Build&#45;&gt;repo2 -->
<g id="edge6" class="edge">
<title>Build&#45;&gt;repo2</title>
<path fill="none" stroke="#000000" d="M171.271,-59.6113C182.1119,-53.9987 195.2813,-47.1806 207.7959,-40.7015"/>
<polygon fill="#000000" stroke="#000000" points="209.4789,-43.7715 216.7502,-36.0657 206.2605,-37.5552 209.4789,-43.7715"/>
</g>
<!-- Package -->
<g id="node4" class="node">
<title>Package</title>
<ellipse fill="none" stroke="#000000" cx="366.6552" cy="-72" rx="43.4183" ry="18"/>
<text text-anchor="middle" x="366.6552" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Package</text>
</g>
<!-- Test&#45;&gt;Package -->
<g id="edge3" class="edge">
<title>Test&#45;&gt;Package</title>
<path fill="none" stroke="#000000" d="M279.4855,-72C289.6663,-72 301.5553,-72 313.2198,-72"/>
<polygon fill="#000000" stroke="#000000" points="313.3642,-75.5001 323.3641,-72 313.3641,-68.5001 313.3642,-75.5001"/>
</g>
<!-- Deploy -->
<g id="node5" class="node">
<title>Deploy</title>
<ellipse fill="none" stroke="#000000" cx="485.3275" cy="-72" rx="39.4273" ry="18"/>
<text text-anchor="middle" x="485.3275" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Deploy</text>
</g>
<!-- Package&#45;&gt;Deploy -->
<g id="edge4" class="edge">
<title>Package&#45;&gt;Deploy</title>
<path fill="none" stroke="#000000" d="M410.1705,-72C418.4476,-72 427.1677,-72 435.6201,-72"/>
<polygon fill="#000000" stroke="#000000" points="435.7495,-75.5001 445.7495,-72 435.7494,-68.5001 435.7495,-75.5001"/>
</g>
</g>
</svg>
</div>

<p>图中的“代码库”，通常由版本管理软件负责，比如git,svn。</p>
<p>对于软件的配置信息，开发团队通常不会很十分在意——要么随源代码一起放入版本库，要么由“实施人员”临时配置。</p>
<h1 id="开发和运维"><a href="#开发和运维" class="headerlink" title="开发和运维"></a>开发和运维</h1><p>企业应用的环境中，通常开发团队和运维团队是分开的。这就形成了一堵墙:</p>
<img src="/2014/03/04/ci_tools/WallOfConfusion_Release.png" class="">

<p>当软件系统从墙的一端(Dev)传递到另一端(Ops)时，会发生各种各样不可预知的情况发生。这些“异常”通常是由于交付了不正确的东西：</p>
<ul>
<li>开发人员不清楚生成环境，而运维人员又搞不定即没有规范又没有文档的配置</li>
<li>开发过程中的不成熟版本进入了生成环境</li>
<li>……</li>
</ul>
<p>在开发团队和运维团队之间，也应该有一个信息交换和缓冲带，主要是：</p>
<div style="margin: 0.5em 0px; display: block!important; text-align: center"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="549pt" height="139pt"
 viewBox="0.00 0.00 548.79 139.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 135)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-135 544.7911,-135 544.7911,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_process</title>
<polygon fill="none" stroke="#000000" points="8,-46 8,-123 532.7911,-123 532.7911,-46 8,-46"/>
<text text-anchor="middle" x="270.3956" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#000000">开发过程</text>
</g>
<!-- Code -->
<g id="node1" class="node">
<title>Code</title>
<ellipse fill="none" stroke="#000000" cx="47.4204" cy="-72" rx="31.341" ry="18"/>
<text text-anchor="middle" x="47.4204" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Code</text>
</g>
<!-- Build -->
<g id="node2" class="node">
<title>Build</title>
<ellipse fill="none" stroke="#000000" cx="147.3418" cy="-72" rx="32.502" ry="18"/>
<text text-anchor="middle" x="147.3418" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Build</text>
</g>
<!-- Code&#45;&gt;Build -->
<g id="edge1" class="edge">
<title>Code&#45;&gt;Build</title>
<path fill="none" stroke="#000000" d="M79.0361,-72C87.0845,-72 95.8704,-72 104.38,-72"/>
<polygon fill="#000000" stroke="#000000" points="104.5546,-75.5001 114.5546,-72 104.5546,-68.5001 104.5546,-75.5001"/>
</g>
<!-- repo1 -->
<g id="node6" class="node">
<title>repo1</title>
<polygon fill="none" stroke="#000000" points="176.0568,-36 173.0568,-40 152.0568,-40 149.0568,-36 118.6268,-36 118.6268,0 176.0568,0 176.0568,-36"/>
<text text-anchor="middle" x="147.3418" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">代码库</text>
</g>
<!-- Code&#45;&gt;repo1 -->
<g id="edge5" class="edge">
<title>Code&#45;&gt;repo1</title>
<path fill="none" stroke="#000000" d="M70.5955,-59.4756C82.2124,-53.1975 96.5724,-45.437 109.7171,-38.3333"/>
<polygon fill="#000000" stroke="#000000" points="111.441,-41.3802 118.5744,-33.5466 108.1129,-35.2219 111.441,-41.3802"/>
</g>
<!-- Test -->
<g id="node3" class="node">
<title>Test</title>
<ellipse fill="none" stroke="#000000" cx="251.6447" cy="-72" rx="27.8248" ry="18"/>
<text text-anchor="middle" x="251.6447" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Test</text>
</g>
<!-- Build&#45;&gt;Test -->
<g id="edge2" class="edge">
<title>Build&#45;&gt;Test</title>
<path fill="none" stroke="#000000" d="M180.0577,-72C190.7424,-72 202.6973,-72 213.7313,-72"/>
<polygon fill="#000000" stroke="#000000" points="213.9566,-75.5001 223.9566,-72 213.9565,-68.5001 213.9566,-75.5001"/>
</g>
<!-- repo2 -->
<g id="node7" class="node">
<title>repo2</title>
<polygon fill="none" stroke="#000000" points="287.2496,-36 284.2496,-40 263.2496,-40 260.2496,-36 216.0398,-36 216.0398,0 287.2496,0 287.2496,-36"/>
<text text-anchor="middle" x="251.6447" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">配置库</text>
</g>
<!-- Build&#45;&gt;repo2 -->
<g id="edge6" class="edge">
<title>Build&#45;&gt;repo2</title>
<path fill="none" stroke="#000000" d="M171.271,-59.6113C182.1119,-53.9987 195.2813,-47.1806 207.7959,-40.7015"/>
<polygon fill="#000000" stroke="#000000" points="209.4789,-43.7715 216.7502,-36.0657 206.2605,-37.5552 209.4789,-43.7715"/>
</g>
<!-- Package -->
<g id="node4" class="node">
<title>Package</title>
<ellipse fill="none" stroke="#000000" cx="366.6552" cy="-72" rx="43.4183" ry="18"/>
<text text-anchor="middle" x="366.6552" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Package</text>
</g>
<!-- Test&#45;&gt;Package -->
<g id="edge3" class="edge">
<title>Test&#45;&gt;Package</title>
<path fill="none" stroke="#000000" d="M279.4855,-72C289.6663,-72 301.5553,-72 313.2198,-72"/>
<polygon fill="#000000" stroke="#000000" points="313.3642,-75.5001 323.3641,-72 313.3641,-68.5001 313.3642,-75.5001"/>
</g>
<!-- Deploy -->
<g id="node5" class="node">
<title>Deploy</title>
<ellipse fill="none" stroke="#000000" cx="485.3275" cy="-72" rx="39.4273" ry="18"/>
<text text-anchor="middle" x="485.3275" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Deploy</text>
</g>
<!-- Package&#45;&gt;Deploy -->
<g id="edge4" class="edge">
<title>Package&#45;&gt;Deploy</title>
<path fill="none" stroke="#000000" d="M410.1705,-72C418.4476,-72 427.1677,-72 435.6201,-72"/>
<polygon fill="#000000" stroke="#000000" points="435.7495,-75.5001 445.7495,-72 435.7494,-68.5001 435.7495,-75.5001"/>
</g>
<!-- repo3 -->
<g id="node8" class="node">
<title>repo3</title>
<polygon fill="none" stroke="#000000" points="513.0939,-36 510.0939,-40 489.0939,-40 486.0939,-36 457.561,-36 457.561,0 513.0939,0 513.0939,-36"/>
<text text-anchor="middle" x="485.3275" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">交付库</text>
</g>
<!-- Package&#45;&gt;repo3 -->
<g id="edge7" class="edge">
<title>Package&#45;&gt;repo3</title>
<path fill="none" stroke="#000000" d="M395.9899,-58.6517C411.7111,-51.498 431.2453,-42.6093 448.0347,-34.9695"/>
<polygon fill="#000000" stroke="#000000" points="449.9009,-37.9657 457.5533,-30.6382 447.0016,-31.5943 449.9009,-37.9657"/>
</g>
<!-- repo3&#45;&gt;Deploy -->
<g id="edge8" class="edge">
<title>repo3&#45;&gt;Deploy</title>
<path fill="none" stroke="#000000" d="M485.3275,-36.1406C485.3275,-38.6226 485.3275,-41.1046 485.3275,-43.5865"/>
<polygon fill="#000000" stroke="#000000" points="481.8276,-43.7901 485.3275,-53.7902 488.8276,-43.7902 481.8276,-43.7901"/>
</g>
</g>
</svg>
</div>

<ul>
<li><p>配置库</p>
<p>有严格的环境(开发、测试、生产环境)区分，有版本管理的配置库，开发人员和运维人员各自维护自己需要的配置信息。</p>
</li>
<li><p>交付库</p>
<p>经过测试，符合要求的软件版本，经过规范的打包后，才允许进入交付库。交付库的软件包是部署生成环境的唯一来源。</p>
</li>
</ul>
<h1 id="自动化工具"><a href="#自动化工具" class="headerlink" title="自动化工具"></a>自动化工具</h1><p>有了代码库、配置库和交付库，加上繁杂的管理规范、流程指南，额外配上检查员、管理员，大概就可以完成上述的过程。</p>
<p>但是，我们需要自动化！持续集成(CI)工具就是时上述过程自动化的有力工具——以至于随时可以以很小的代价将上述过程跑一遍。</p>
<p>持续集成工具的主要功能如下图：</p>
<div style="margin: 0.5em 0px; display: block!important; text-align: center"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="576pt" height="157pt"
 viewBox="0.00 0.00 575.61 156.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 152.8)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-152.8 571.6073,-152.8 571.6073,4 -4,4"/>
<g id="clust4" class="cluster">
<title>cluster_ci</title>
<polygon fill="none" stroke="#000000" points="48.6073,-64 48.6073,-140.8 478.6073,-140.8 478.6073,-64 48.6073,-64"/>
<text text-anchor="middle" x="263.6073" y="-124.2" font-family="Times,serif" font-size="14.00" fill="#000000">持续集成</text>
</g>
<!-- repo1 -->
<g id="node1" class="node">
<title>repo1</title>
<polygon fill="none" stroke="#000000" points="57.3223,-36 54.3223,-40 33.3223,-40 30.3223,-36 -.1077,-36 -.1077,0 57.3223,0 57.3223,-36"/>
<text text-anchor="middle" x="28.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">代码库</text>
</g>
<!-- Code -->
<g id="node2" class="node">
<title>Code</title>
<ellipse fill="none" stroke="#000000" cx="106.6073" cy="-18" rx="31.341" ry="18"/>
<text text-anchor="middle" x="106.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Code</text>
</g>
<!-- repo1&#45;&gt;Code -->
<g id="edge1" class="edge">
<title>repo1&#45;&gt;Code</title>
<path fill="none" stroke="#000000" d="M57.2479,-18C59.7424,-18 62.2369,-18 64.7314,-18"/>
<polygon fill="#000000" stroke="#000000" points="64.9865,-21.5001 74.9865,-18 64.9864,-14.5001 64.9865,-21.5001"/>
</g>
<!-- m1 -->
<g id="node3" class="node">
<title>m1</title>
<polygon fill="none" stroke="#000000" points="128.4493,-108 56.7653,-108 56.7653,-72 128.4493,-72 128.4493,-108"/>
<text text-anchor="middle" x="92.6073" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#000000">工程管理</text>
</g>
<!-- repo1&#45;&gt;m1 -->
<g id="edge2" class="edge">
<title>repo1&#45;&gt;m1</title>
<path fill="none" stroke="#000000" d="M44.9746,-36.4133C52.4507,-44.8239 61.436,-54.9323 69.5782,-64.0923"/>
<polygon fill="#000000" stroke="#000000" points="67.1978,-66.6825 76.4574,-71.8314 72.4297,-62.032 67.1978,-66.6825"/>
</g>
<!-- Build -->
<g id="node4" class="node">
<title>Build</title>
<ellipse fill="none" stroke="#000000" cx="188.6073" cy="-18" rx="32.502" ry="18"/>
<text text-anchor="middle" x="188.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Build</text>
</g>
<!-- Code&#45;&gt;Build -->
<g id="edge3" class="edge">
<title>Code&#45;&gt;Build</title>
<path fill="none" stroke="#000000" d="M138.3182,-18C140.8045,-18 143.2907,-18 145.7769,-18"/>
<polygon fill="#000000" stroke="#000000" points="145.998,-21.5001 155.998,-18 145.998,-14.5001 145.998,-21.5001"/>
</g>
<!-- Test -->
<g id="node5" class="node">
<title>Test</title>
<ellipse fill="none" stroke="#000000" cx="266.6073" cy="-18" rx="27.8248" ry="18"/>
<text text-anchor="middle" x="266.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Test</text>
</g>
<!-- Build&#45;&gt;Test -->
<g id="edge4" class="edge">
<title>Build&#45;&gt;Test</title>
<path fill="none" stroke="#000000" d="M221.2089,-18C223.7027,-18 226.1965,-18 228.6903,-18"/>
<polygon fill="#000000" stroke="#000000" points="228.9427,-21.5001 238.9426,-18 228.9426,-14.5001 228.9427,-21.5001"/>
</g>
<!-- Package -->
<g id="node6" class="node">
<title>Package</title>
<ellipse fill="none" stroke="#000000" cx="355.6073" cy="-18" rx="43.4183" ry="18"/>
<text text-anchor="middle" x="355.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Package</text>
</g>
<!-- Test&#45;&gt;Package -->
<g id="edge5" class="edge">
<title>Test&#45;&gt;Package</title>
<path fill="none" stroke="#000000" d="M294.4198,-18C296.907,-18 299.3943,-18 301.8815,-18"/>
<polygon fill="#000000" stroke="#000000" points="302.1068,-21.5001 312.1068,-18 302.1068,-14.5001 302.1068,-21.5001"/>
</g>
<!-- Deploy -->
<g id="node7" class="node">
<title>Deploy</title>
<ellipse fill="none" stroke="#000000" cx="456.6073" cy="-18" rx="39.4273" ry="18"/>
<text text-anchor="middle" x="456.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">Deploy</text>
</g>
<!-- Package&#45;&gt;Deploy -->
<g id="edge6" class="edge">
<title>Package&#45;&gt;Deploy</title>
<path fill="none" stroke="#000000" d="M399.0057,-18C401.6308,-18 404.2559,-18 406.881,-18"/>
<polygon fill="#000000" stroke="#000000" points="407.0063,-21.5001 417.0062,-18 407.0062,-14.5001 407.0063,-21.5001"/>
</g>
<!-- m3 -->
<g id="node10" class="node">
<title>m3</title>
<polygon fill="none" stroke="#000000" points="388.3737,-108 385.3737,-112 364.3737,-112 361.3737,-108 332.8409,-108 332.8409,-72 388.3737,-72 388.3737,-108"/>
<text text-anchor="middle" x="360.6073" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#000000">交付库</text>
</g>
<!-- Package&#45;&gt;m3 -->
<g id="edge12" class="edge">
<title>Package&#45;&gt;m3</title>
<path fill="none" stroke="#000000" d="M356.886,-36.4133C357.4229,-44.1442 358.0594,-53.3097 358.6528,-61.8545"/>
<polygon fill="#000000" stroke="#000000" points="355.1611,-62.0979 359.3456,-71.8314 362.1443,-61.6129 355.1611,-62.0979"/>
</g>
<!-- m2 -->
<g id="node8" class="node">
<title>m2</title>
<polygon fill="none" stroke="#000000" points="218.2122,-108 215.2122,-112 194.2122,-112 191.2122,-108 147.0024,-108 147.0024,-72 218.2122,-72 218.2122,-108"/>
<text text-anchor="middle" x="182.6073" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#000000">配置库</text>
</g>
<!-- m2&#45;&gt;Build -->
<g id="edge7" class="edge">
<title>m2&#45;&gt;Build</title>
<path fill="none" stroke="#000000" d="M184.1214,-71.8314C184.7631,-64.131 185.5261,-54.9743 186.2392,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="189.7302,-46.6694 187.0729,-36.4133 182.7544,-46.088 189.7302,-46.6694"/>
</g>
<!-- m4 -->
<g id="node9" class="node">
<title>m4</title>
<polygon fill="none" stroke="#000000" points="315.0877,-108 236.1269,-108 236.1269,-72 315.0877,-72 315.0877,-108"/>
<text text-anchor="middle" x="275.6073" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#000000">自动执行</text>
</g>
<!-- m4&#45;&gt;Build -->
<g id="edge8" class="edge">
<title>m4&#45;&gt;Build</title>
<path fill="none" stroke="#000000" d="M253.6535,-71.8314C241.7612,-61.9894 226.9945,-49.7687 214.5381,-39.4599"/>
<polygon fill="#000000" stroke="#000000" points="216.6749,-36.6852 206.7395,-33.0059 212.2119,-42.078 216.6749,-36.6852"/>
</g>
<!-- m4&#45;&gt;Test -->
<g id="edge9" class="edge">
<title>m4&#45;&gt;Test</title>
<path fill="none" stroke="#000000" d="M273.3362,-71.8314C272.3737,-64.131 271.2291,-54.9743 270.1594,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="273.6224,-45.9019 268.909,-36.4133 266.6764,-46.7702 273.6224,-45.9019"/>
</g>
<!-- m4&#45;&gt;Package -->
<g id="edge10" class="edge">
<title>m4&#45;&gt;Package</title>
<path fill="none" stroke="#000000" d="M295.7947,-71.8314C306.0749,-62.5792 318.691,-51.2247 329.682,-41.3327"/>
<polygon fill="#000000" stroke="#000000" points="332.2499,-43.7305 337.3414,-34.4393 327.5671,-38.5274 332.2499,-43.7305"/>
</g>
<!-- m4&#45;&gt;Deploy -->
<g id="edge11" class="edge">
<title>m4&#45;&gt;Deploy</title>
<path fill="none" stroke="#000000" d="M306.9764,-71.9985C312.4405,-69.1556 318.1293,-66.375 323.6073,-64 359.7129,-48.3466 370.4667,-49.0085 407.6073,-36 410.466,-34.9987 413.4134,-33.9521 416.3777,-32.8891"/>
<polygon fill="#000000" stroke="#000000" points="417.6032,-36.1678 425.8148,-29.473 415.2206,-29.5857 417.6032,-36.1678"/>
</g>
<!-- m5 -->
<g id="node11" class="node">
<title>m5</title>
<polygon fill="none" stroke="#000000" points="470.7123,-108 406.5023,-108 406.5023,-72 470.7123,-72 470.7123,-108"/>
<text text-anchor="middle" x="438.6073" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#000000">发布管理</text>
</g>
<!-- servers -->
<g id="node12" class="node">
<title>servers</title>
<polygon fill="none" stroke="#000000" points="567.6073,-36 517.6073,-36 513.6073,-32 513.6073,0 563.6073,0 567.6073,-4 567.6073,-36"/>
<polyline fill="none" stroke="#000000" points="563.6073,-32 513.6073,-32 "/>
<polyline fill="none" stroke="#000000" points="563.6073,-32 563.6073,0 "/>
<polyline fill="none" stroke="#000000" points="563.6073,-32 567.6073,-36 "/>
<text text-anchor="middle" x="540.6073" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">服务器</text>
</g>
<!-- m5&#45;&gt;servers -->
<g id="edge13" class="edge">
<title>m5&#45;&gt;servers</title>
<path fill="none" stroke="#000000" d="M464.3462,-71.8314C477.151,-62.7927 492.7982,-51.7476 506.5792,-42.0198"/>
<polygon fill="#000000" stroke="#000000" points="508.7253,-44.7891 514.8766,-36.1628 504.6885,-39.0703 508.7253,-44.7891"/>
</g>
</g>
</svg>
</div>

<p>CI工具实现了与代码库关联的软件工程管理，能够自动执行构建、测试、打包、发布等操作。<br>CI工具通常内置了配置库和交付库，在自动构建时可以从配置库获取配置信息，在自动发布时从交付库取得指定的软件版本并部署到服务器。<br>此外，CI工具还会提供事件通知、生成报告等功能。</p>
<h1 id="常见的CI工具"><a href="#常见的CI工具" class="headerlink" title="常见的CI工具"></a>常见的CI工具</h1><ul>
<li><a href="http://hudson-ci.org/" target="_blank" rel="noopener">Hudson</a></li>
</ul>
<p>这个大概是最流行的CI工具了，使用Java开发。</p>
<img src="/2014/03/04/ci_tools/ci-hudson.jpg" class="">

<ul>
<li><p><a href="http://buildbot.net/" target="_blank" rel="noopener">BuildBot</a></p>
<p>使用Python语言开发。好用，但是有点小众。</p>
<img src="/2014/03/04/ci_tools/ci-buildbot.jpg" class="">
</li>
<li><p><a href="http://jenkins-ci.org/" target="_blank" rel="noopener">Jenkins</a></p>
<p>也是使用Java开发。</p>
<img src="/2014/03/04/ci_tools/12323PJW.png" class="">
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/02/20/apache_karaf.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/02/20/apache_karaf.html" class="post-title-link" itemprop="url">Apache Karaf：OSGi中间件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-02-20 00:00:00" itemprop="dateCreated datePublished" datetime="2014-02-20T00:00:00+08:00">2014-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">软件技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="为什么需要“OSGi中间件”"><a href="#为什么需要“OSGi中间件”" class="headerlink" title="为什么需要“OSGi中间件”"></a>为什么需要“OSGi中间件”</h1><p>尽管在OSGi Runtime(Felix, Equinox等)的基础上，OSGi组织又规定了<a href="/2014/01/22/osgi_blueprint_container.html">Blueprint规范以实现OSGi环境下的依赖注入</a>，<br>但这还不够——没有提供类似Web开发框架那样的一些“平台级”的功能。比如日志，控制台，配置文件等。</p>
<p>很难想象没有Tomcat这样的Web中间件，开发Java Web应用的工作量有多大。同样的，OSGi应用也需要一种“中间件”，来实现各应用共性的一些功能，并管理应用的部署。</p>
<p><a href="http://karaf.apache.org/" target="_blank" rel="noopener">Apache Karaf</a>就是这样的一个”OSGi中间件”。最早，Karaf只是<a href="http://servicemix.apache.org/" target="_blank" rel="noopener">Apache ServiceMix</a>的Kernel子项目，后来独立出来成为Apache的顶级项目。<br>目前，Apache Karaf已经用于Apache Geronimo, Apache ServiceMix, Fuse ESB等项目。</p>
<p>Apache Karaf的主要竞争对手是<a href="http://www.eclipse.org/virgo/" target="_blank" rel="noopener">Eclipse Virgo</a>。</p>
<h1 id="Apache-Karaf的功能"><a href="#Apache-Karaf的功能" class="headerlink" title="Apache Karaf的功能"></a>Apache Karaf的功能</h1><img src="/2014/02/20/apache_karaf/Karaf.jpg" class="">

<p>Apache Karaf提供了如下“开箱即用”的功能：</p>
<ul>
<li><p>热部署</p>
<p>尽管OSGi支持热部署，但并不是自动热部署，需要调用一些API去执行插拔的动作。Karaf在运行时可以自动处理<code>[home]/deploy</code>文件夹中的OSGi bundle，能够自动加载并在满足依赖关系时自动启动。</p>
</li>
<li><p>动态配置</p>
<p>Karaf在<code>$KARAF_HOME/etc</code>文件夹中存储配置文件。这些配置内容可以在Karaf运行时动态修改。</p>
</li>
<li><p>日志处理</p>
<p>基于Log4J的日志系统，同时支持多种日志API，如JDK 1.4, JCL, SLF4J, Avalon, Tomcat, OSGi等。</p>
</li>
<li><p>系统服务</p>
<p>Karaf可以作为系统服务运行。</p>
</li>
<li><p>控制台</p>
<p>可以在控制台进行服务管理、安装bundle等操作。还可以扩展自己的控制台命令。</p>
<p>可以通过SSH远程访问其他服务器上的Karaf控制台。</p>
</li>
<li><p>多实例管理</p>
<p>一个服务器上可以运行多个Karaf实例。对实例的管理可以在Karaf控制台中进行。</p>
</li>
<li><p>Bundle仓库</p>
<p>Karaf中内置了<a href="https://ops4j1.jira.com/wiki/display/paxurl/Pax+URL" target="_blank" rel="noopener">Pax URL</a>的MVN协议，可以从Maven中央仓库安装bundle。</p>
</li>
<li><p>Bundle集合(Feature)</p>
<p>类似于Eclipse的Feature，Karaf中也支持Feature，即bundle的集合。使用Feature可以简化OSGi应用的部署。</p>
</li>
</ul>
<h1 id="Karaf初体验"><a href="#Karaf初体验" class="headerlink" title="Karaf初体验"></a>Karaf初体验</h1><p>安装好Java环境，加压缩Karaf，执行<code>$KARAF_HOME/bin/karaf</code>，可以看到Karaf的启动界面：</p>
<img src="/2014/02/20/apache_karaf/karaf1.png" class="">

<p>如图的提示，使用<code>&lt;tab&gt;</code>可以列出所有可用的命令，所有的命令支持<code>--help</code>参数。</p>
<p>如果执行<code>list</code>命令，可以列出所有的bundles:</p>
<img src="/2014/02/20/apache_karaf/karaf2.png" class="">

<p>还有很多其他的命令，比如</p>
<ul>
<li><code>bundle:install</code> 安装bundle</li>
<li><code>feature:repo-add</code> 安装feature库</li>
<li><code>feature:install</code> 安装feature</li>
</ul>
<p>等等。详情可以参考官方的<a href="http://karaf.apache.org/manual/latest/quick-start.html" target="_blank" rel="noopener">Quick Start</a>。</p>
<p>如果查看Karaf的目录，可以看到如下的目录结构：</p>
<ul>
<li><code>/bin</code>: 启动、停止、登录karaf控制台的脚本</li>
<li><code>/etc</code>: 配置文件</li>
<li><code>/data</code>: 存放运行时的工作文件，清空这个目录可以使Karaf回到初始状态</li>
<li><code>/cache</code>: OSGi framework的bundle缓存</li>
<li><code>/generated-bundles</code>: 开发用的临时目录</li>
<li><code>/log</code>: 日志</li>
<li><code>/deploy</code>: 用于bundle的热部署</li>
<li><code>/instances</code>: 存放karaf的各个实例用到的数据</li>
<li><code>/lib</code>: 启动Karaf时需要的一些库</li>
<li><code>/lib/ext</code>: Karaf需要的扩展库</li>
<li><code>/lib/endorsed</code>: Karaf对其他API的再封装(背书)的一些jar包</li>
<li><code>/system</code>: OSGi bundles库，使用Maven 2仓库的结构</li>
</ul>
<h1 id="Karaf启动模式和实例"><a href="#Karaf启动模式和实例" class="headerlink" title="Karaf启动模式和实例"></a>Karaf启动模式和实例</h1><ul>
<li>常规模式(regular mode) 使用命令<code>bin/karaf</code>，可以在前端启动Karaf并进入控制台</li>
<li>服务模式(server mode) 使用命令<code>bin/karaf server</code>，可以在前端启动Karaf，但不进入控制台</li>
<li>后台模式(background mode) 使用命令<code>bin/start</code>，可以在后台启动Karaf。</li>
</ul>
<p>如果安装了service-wrapper(可以在Karaf中执行<code>feature:install service-wrapper</code>)，还可以将<br>Karaf安装为系统服务。</p>
<p>一个Karaf节点可以运行多个”Karaf实例”。实际上，默认情况下Karaf会启动一个名为<code>root</code>的实例。<br>实例是包含单独的配置文件、数据文件等信息的一个Karaf副本，每个实例可以单独启动或部署bundle。</p>
<p>Karaf控制台中提供了一些管理实例的命令：</p>
<ul>
<li><code>instance:create</code> 创建实例</li>
<li><code>instance:clone</code> 从现有的实例克隆一个新的实例</li>
<li><code>instance:start</code> 启动实例</li>
<li><code>instance:status</code> 查看实例状态</li>
<li><code>instance:connect</code> 连接(切换)到某个实例</li>
<li><code>instance:stop</code> 停止实例</li>
<li><code>instance:destroy</code> 删除实例</li>
</ul>
<h1 id="ssh、客户端和Web控制台"><a href="#ssh、客户端和Web控制台" class="headerlink" title="ssh、客户端和Web控制台"></a>ssh、客户端和Web控制台</h1><p>Karaf内置了一个SSHd server，可以通过ssh远程访问Karaf控制台。<br>要启动远程控制台服务，需要在控制台中启动bundle: <code>bundle:restart -f org.apache.karaf.shell.ssh</code>。此时，远端可以使用ssh远程访问控制台，比如: <code>ssh -p 8101 karaf@localhost</code>。默认karaf用户的密码也是karaf。ssh的用户、密码、端口等都可以在<code>etc/org.apache.karaf.shell.cfg</code>中配置。</p>
<p>Karaf的客户端’bin/client’即可以连接本地控制台，也可以通过ssh连接远程控制台，甚至可以执行单个的命令。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin&#x2F;client -u karaf -p karaf -a 8101 hostname osgi:shutdown</span><br></pre></td></tr></table></figure>


<p>Karaf还可以安装Web控制台(<code>feature:install webconsole</code>)。通过Web控制台能够管理<br>Karaf的bundle、feature、实例、配置以及查看日志。启动web控制台后，默认可以通过<a href="http://localhost:8181/system/console" target="_blank" rel="noopener">http://localhost:8181/system/console</a><br>访问web控制台，默认的用户名/密码为<code>karaf/karaf</code>。Web控制台的配置文件位于<code>etc/org.ops4j.pax.web.cfg</code>。</p>
<h1 id="bundle-URL和bundle仓库"><a href="#bundle-URL和bundle仓库" class="headerlink" title="bundle URL和bundle仓库"></a>bundle URL和bundle仓库</h1><p>Karaf在安装bundle时，可以使用多种URL来定位bundle，比如：</p>
<ul>
<li><p>http <code>http://repo1.maven.org/maven2/org/apache/servicemix/nmr/org.apache.servicemix.nmr.api/1.0.0-m2/org.apache.servicemix.nmr.api-1.0.0-m2.jar</code></p>
</li>
<li><p>file <code>file:base/bundles/org.apache.servicemix.nmr.api-1.0.0-m2.jar</code></p>
</li>
<li><p>maven库 <code>mvn:org.apache.servicemix.nmr/org.apache.servicemix.nmr.api/1.0.0-m2</code></p>
</li>
</ul>
<p>其中，maven库方式是使用maven库作为bundle仓库，从其中检索需要的bundle。与maven类似，可以自动解决bundle之间的依赖问题。<br>Karaf提供了OBR (OSGi Bundle Repository)，能够管理bundle仓库。在控制台使用命令<code>feature:install obr</code>安装OBR之后，就可以：</p>
<ul>
<li><p>增加新的bundle仓库</p>
<p><code>obr:url-add file:///user/.m2/repository/repository.xml</code></p>
</li>
<li><p>查看已安装的bundle仓库</p>
<p><code>obr:url-list</code></p>
</li>
<li><p>刷新仓库</p>
<p><code>obr:url-refresh</code></p>
</li>
<li><p>删除仓库</p>
<p><code>obr:url-remove</code></p>
</li>
<li><p>列出所有可用的bundle</p>
<p><code>obr:list</code></p>
</li>
<li><p>查找bundle</p>
<p><code>obr:find</code></p>
</li>
</ul>
<h1 id="OSGi应用，Karaf-Feature和KAR"><a href="#OSGi应用，Karaf-Feature和KAR" class="headerlink" title="OSGi应用，Karaf Feature和KAR"></a>OSGi应用，Karaf Feature和KAR</h1><p>OSGi运行的基本单元是bundle，bundle之间有依赖关系。一组满足依赖关系的bundle集合，加上相关的配置信息，称为一个“OSGi应用”。<br>将OSGi应用部署到Karaf的行为称为“provisioning”。</p>
<p>为了简化OSGi应用的部署，Karaf定义了feature，用于描述OSGi应用的部署信息，包括：</p>
<ul>
<li>名称</li>
<li>版本号</li>
<li>描述信息</li>
<li>bundle集合</li>
<li>配置文件信息</li>
<li>依赖的其他feature</li>
</ul>
<p>可以看出，Karaf中的feature与Eclipse Feature非常类似。</p>
<p>Karaf控制台中提供了一系列的feature和feature库的管理命令，包括：</p>
<ul>
<li>feature:info</li>
<li>feature:install</li>
<li>feature:list</li>
<li>feature:repo-add</li>
<li>feature:repo-list</li>
<li>feature:repo-refresh</li>
<li>feature:repo-remove</li>
<li>feature:uninstall</li>
<li>feature:version-list</li>
</ul>
<p>由于feature中可能使用远端的bundle，Karaf提出了<code>KAR</code>格式，可以把一个bundle相关的所有资源打包在一起。<br>这类似于使用maven定义的web工程，和最终打包的war文件之间的关系。<br>Karaf控制台中，可以打包(<code>kar:create</code>)、安装(<code>kar:install</code>)、卸载(<code>kar:uninstall</code>)或列出(<code>kar:list</code>)KAR文件。</p>
<h1 id="企业级特性"><a href="#企业级特性" class="headerlink" title="企业级特性"></a>企业级特性</h1><p>Karaf提供了一系列的功能，以支持企业级应用的开发，包括：</p>
<ul>
<li><p>日志</p>
<p>Karaf提供了<a href="http://karaf.apache.org/manual/latest/users-guide/log.html" target="_blank" rel="noopener">灵活的日志系统</a>，支持</p>
<ul>
<li>OSGi Log Service</li>
<li>Log4j</li>
<li>Commons Logging</li>
<li>Logback</li>
<li>SLF4J</li>
<li>java Util Logging</li>
</ul>
<p>等日志框架。不管应用中使用了上述哪种日志框架，Karaf中都可以进行统一的管理，如log level, appender等。</p>
</li>
<li><p>安全</p>
<p>Karaf提供了基于JAAS(Java Authentication and Authorization Service)的<a href="http://karaf.apache.org/manual/latest/users-guide/security.html" target="_blank" rel="noopener">安全框架</a>，可以控制对OSGi service、控制台命令、JMX、Web控制台等资源的访问。并且在应用中也可以使用Karaf的安全框架。</p>
</li>
<li><p>Web</p>
<p>Karaf可以<a href="http://karaf.apache.org/manual/latest/users-guide/webcontainer.html" target="_blank" rel="noopener">作为Web容器</a>使用，完全支持JSP/Servlet规范。<br>Karaf的Web容器同时支持WAR和WAB的部署。</p>
</li>
<li><p>JNDI</p>
<p>Karaf<a href="http://karaf.apache.org/manual/latest/users-guide/jndi.html" target="_blank" rel="noopener">支持OSGi中的JNDI服务</a>。</p>
</li>
</ul>
<ul>
<li><p>JDBC、JPA和JTA</p>
<p>Karaf中即可以<a href="http://karaf.apache.org/manual/latest/users-guide/jdbc.html" target="_blank" rel="noopener">使用JDBC</a>直接连接数据库，<br>也可以<a href="http://karaf.apache.org/manual/latest/users-guide/jpa.html" target="_blank" rel="noopener">使用JPA</a>作为持久层框架。Karaf可以通过Blueprint管理JPA的persist Unit。</p>
<p>Karaf支持<a href="http://karaf.apache.org/manual/latest/users-guide/jta.html" target="_blank" rel="noopener">JTA</a>，以实现容器管理的事务。</p>
</li>
<li><p>其他</p>
<p>Karaf还支持<a href="http://karaf.apache.org/manual/latest/users-guide/ejb.html" target="_blank" rel="noopener">EJB</a>、<a href="http://karaf.apache.org/manual/latest/users-guide/cdi.html" target="_blank" rel="noopener">CDI</a>、<a href="http://karaf.apache.org/manual/latest/users-guide/monitoring.html" target="_blank" rel="noopener">JMX</a>、<a href="http://karaf.apache.org/manual/latest/users-guide/jms.html" target="_blank" rel="noopener">JMS</a>等企业级特性。</p>
<p>Karaf内置支持主备方式的部署，以保证高可用。使用<a href="http://karaf.apache.org/index/subprojects/cellar.html" target="_blank" rel="noopener">Apache Karaf Cellar</a>可以实现Karaf的集群部署。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/02/17/graphviz_intro.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/02/17/graphviz_intro.html" class="post-title-link" itemprop="url">Graphviz概述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-02-17 00:00:00" itemprop="dateCreated datePublished" datetime="2014-02-17T00:00:00+08:00">2014-02-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:22" itemprop="dateModified" datetime="2018-04-16T11:04:22+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%B9%E6%B3%95%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">方法工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Graphviz是一个强大的绘图工具，使用DOT语言描述图像。</p>
<h1 id="Graphviz是什么"><a href="#Graphviz是什么" class="headerlink" title="Graphviz是什么"></a>Graphviz是什么</h1><p><a href="http://www.graphviz.org/" target="_blank" rel="noopener">Graphviz</a>是基于dot语言的绘图工具，可以画有向图、无向图、关系图、目录图、流程图等各种你知道的或不知道的图形。可以欣赏Graphviz的<a href="http://www.graphviz.org/Gallery.php" target="_blank" rel="noopener">Gallery</a>，以及Yifan Hu的<a href="http://www2.research.att.com/~yifanhu/GALLERY/GRAPHS/index1.html" target="_blank" rel="noopener">gallery of large graphs</a>。</p>
<p>Graphviz使用<a href="http://zh.wikipedia.org/wiki/DOT%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener">DOT语言</a>描述图形，并提供一组工具：</p>
<ul>
<li><p>dot</p>
<p>将生成的图形转换成多种输出格式，如PostScript，PDF，SVG，PNG，含注解的文本等等。</p>
</li>
<li><p>neato</p>
<p>用于sprint model的生成（在Mac OS版本中称为energy minimized）。</p>
</li>
<li><p>twopi</p>
<p>用于放射状图形的生成</p>
</li>
<li><p>circo</p>
<p>用于圆形图形的生成。</p>
</li>
<li><p>fdp</p>
<p>另一个用于生成无向图的工具。</p>
</li>
<li><p>dotty</p>
<p>一个用于可视化与修改图形的图形用户界面程序。</p>
</li>
<li><p>lefty</p>
<p>一个可编程的控件，它可以显示DOT图形，并允许用户用鼠标在图上执行操作。Lefty可以作为MVC模型的使用图形的GUI程序中的视图部分。</p>
</li>
</ul>
<p>Graphviz使用<a href="http://zh.wikipedia.org/wiki/DOT%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener">DOT语言</a>描述图形，而不是依赖于鼠标绘图，这就提供了无限的可能，主要体现在两个方面：</p>
<ul>
<li>自动生成图形描述文件，从而自动生成图形</li>
<li>更加Geek的写作方式，比如在Org-mode中嵌入图形代码，在导出时自动生成图形文件</li>
</ul>
<p>有一些强大的工具依赖或支持Graphviz，比如<a href="http://www.omnigroup.com/omnigraffle" target="_blank" rel="noopener">OmniGraffle</a><br>和<a href="http://plantuml.sourceforge.net/index.html" target="_blank" rel="noopener">PlantUML</a>。</p>
<h1 id="DOT语言简介"><a href="#DOT语言简介" class="headerlink" title="DOT语言简介"></a>DOT语言简介</h1><p>DOT语言使用离散数学中的Graph描述图形，包括三个基本元素：grahp,node,edge。下面是一个例子：</p>
<p><code>example.dot</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">digraph G &#123;</span><br><span class="line">main -&gt; parse -&gt; execute[label&#x3D;&quot;edge label2&quot;];</span><br><span class="line">main -&gt; init[label&#x3D;&quot;edge label1&quot;];</span><br><span class="line">main -&gt; cleanup;</span><br><span class="line">execute -&gt; make_string;</span><br><span class="line">execute -&gt; printf;</span><br><span class="line">init -&gt; make_string;</span><br><span class="line">main -&gt; printf;</span><br><span class="line">execute -&gt; compare;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行命令<code>dot -Tpng example.dot -o example.png</code>，就可以生成如下的图形：</p>
<img src="/2014/02/17/graphviz_intro/example.png" class="">

<p>DOT通过属性可以设置node和edge的样式，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph graphname &#123;</span><br><span class="line">     &#x2F;&#x2F; label属性可以改变节点的显示名称</span><br><span class="line">     a [label&#x3D;&quot;Foo&quot;];     &#x2F;&#x2F; 节点形状被改变了</span><br><span class="line">     b [shape&#x3D;box];     &#x2F;&#x2F; a-b边和b-c边有相同的属性</span><br><span class="line">     a -- b -- c [color&#x3D;blue];</span><br><span class="line">     b -- d [style&#x3D;dotted, label&#x3D;&quot;无向图&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成的图形如下：</p>
<img src="/2014/02/17/graphviz_intro/a.png" class="">

<p>更多的属性设置可以参考<a href="http://www.graphviz.org/content/attrs" target="_blank" rel="noopener">官方文档</a>。</p>
<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><p>Graphviz可以有很多玩法，常见的比如：</p>
<ul>
<li><a href="http://gashero.iteye.com/blog/1748795" target="_blank" rel="noopener">直接使用Graphviz绘图</a>，以代替Visio等绘图工具</li>
<li><a href="http://www.cnblogs.com/lanxuezaipiao/p/3450201.html" target="_blank" rel="noopener">其他工具生成数据，Graphviz进行图表展示</a></li>
<li>利用脚本<a href="http://www.ibm.com/developerworks/cn/aix/library/au-aix-graphviz/index.html?ca=dat" target="_blank" rel="noopener">动态生成图</a></li>
<li>嵌入轻量级标记语言，如org-mode和markdown中</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/02/10/apache_camel.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/02/10/apache_camel.html" class="post-title-link" itemprop="url">Apache Camel的核心概念</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-02-10 00:00:00" itemprop="dateCreated datePublished" datetime="2014-02-10T00:00:00+08:00">2014-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">软件技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Apache-Camel的整体架构"><a href="#Apache-Camel的整体架构" class="headerlink" title="Apache Camel的整体架构"></a>Apache Camel的整体架构</h1><p><a href="http://camel.apache.org/" target="_blank" rel="noopener">Apache Camel</a>是一个消息处理引擎，实现了EIP(Enterprise Integration Patterns,企业整合模式)。</p>
<p>Camel能够用来处理来自于不同源的事件和信息，定义规则进行消息的传递和转换等处理，以实现基于消息的应用整合。其整体架构如下图所示：</p>
<img src="/2014/02/10/apache_camel/camel-architecture.png" class="">


<h1 id="Message-和-Exchange"><a href="#Message-和-Exchange" class="headerlink" title="Message 和 Exchange"></a>Message 和 Exchange</h1><p><code>org.apache.camel.Message</code>接口是对“消息”的抽象。消息由head、body、attachment等部分组成。</p>
<img src="/2014/02/10/apache_camel/message.png" class="">

<p>Camel中提供了一个默认的实现：<code>org.apache.camel.impl.DefaultMessage</code>，可以适应大部分的应用场景。</p>
<p>不管是请求、响应，或者异常，都可以作为消息在上下文(CamelContext)的消息处理器(Processor)之间进行交换(Exchange)。</p>
<p><code>org.apache.camel.Exchange</code>接口就是对“消息交换”的抽象。</p>
<img src="/2014/02/10/apache_camel/exchange.png" class="">

<p>其中：</p>
<ul>
<li>Exchange ID : 区分每次消息交换的标识</li>
<li>MEP: （message exchange pattern，消息交换模式），分为单向(InOnly)和请求-应答(InOut)两种</li>
<li>Exception: 用于记录消息交换时发生的异常</li>
<li>In message: 上一个节点传入的消息</li>
<li>Out message: 当MEP 是InOut时，需要传出的消息</li>
</ul>
<p>Camel提供了默认的<code>org.apache.camel.impl.DefaultExchange</code>实现。</p>
<p>Camel处理消息时，每个节点都在处理<code>Exchange</code>。</p>
<h1 id="Endpoint-和-Component"><a href="#Endpoint-和-Component" class="headerlink" title="Endpoint 和 Component"></a>Endpoint 和 Component</h1><p>Endpoint(端点)，接收或发送消息的通道。通过<a href="http://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E6%A0%87%E5%BF%97%E7%AC%A6" target="_blank" rel="noopener">URI</a>连接消息源或目标。</p>
<p>为了适应各种不同的URI协议，如http,ftp,JMS,smtp等，Camel中提供了多种Endpoint，也支持扩展自己的Endpoint。</p>
<img src="/2014/02/10/apache_camel/endpoints.png" class="">

<p>Component(不应该叫做组件，而应该是连接器connector)。<code>org.apache.camel.Component</code>接口只定义了两个方法：</p>
<ul>
<li><code>createConfiguration(String)</code></li>
<li><code>createEndpoint(String)</code></li>
</ul>
<p>通常，客户代码不会直接调用<code>createEndoint()</code>方法，而是由<code>CamelContext</code>对象进行调用。</p>
<p>Camel中提供了大量的Component的实现：</p>
<img src="/2014/02/10/apache_camel/components.png" class="">


<h1 id="Processor"><a href="#Processor" class="headerlink" title="Processor"></a>Processor</h1><p>不管是消息路由(Message Routing)、消息转换(Message Transformation)还是消息过滤(Message Filter)，都是对消息的某种处理(Process)。</p>
<p>Camel中，抽象出<code>org.apache.camel.Processor</code>接口，表示对消息的处理。该接口只定义了一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void process(Exchange exchange) throws Exception;</span><br></pre></td></tr></table></figure>

<p>从接口定义可以看出，Camel中认为可以处理消息交换(Exchange)的类都是消息处理器(Processor)。</p>
<p>基于Camle的应用可以开发自己的Processor实现，同时Camel提供了大量的内置Processor，以支持<a href="http://camel.apache.org/enterprise-integration-patterns.html" target="_blank" rel="noopener">EIP(Enterprise Integration Patterns)</a>。</p>
<img src="/2014/02/10/apache_camel/processor.png" class="">






<h1 id="CamelContext"><a href="#CamelContext" class="headerlink" title="CamelContext"></a>CamelContext</h1><img src="/2014/02/10/apache_camel/camel_context.jpg" class="">

<p>CamelContext是对Camel运行时的抽象，提供了API用于管理Component、Endpoint、Processor等节点：</p>
<img src="/2014/02/10/apache_camel/context.png" class="">

<p>一般来说，使用Camel的步骤如下：</p>
<ol>
<li>创建一个CamelContext对象。</li>
<li>向CamelContext对象中添加Endpoints或者是Components</li>
<li>向CamelContext对象中添加路由(routes)规则</li>
<li>调用CamelContext的start()方法启动Camel引擎</li>
<li>通过Endpoint发送或接收消息</li>
<li>调用CamelContext的stop()方法时</li>
</ol>
<h1 id="定义路由-Route"><a href="#定义路由-Route" class="headerlink" title="定义路由(Route)"></a>定义路由(Route)</h1><p>每个消息处理流程是由一系列的<code>Processor</code>连接而成的图(Graph)，每个图称为一个路由(Route)。</p>
<p>在开始使用Camel之前，需要在CamelContext中定义一个或多个路由。Camel支持使用DSL或者Spring XML进行配置。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RouteBuilder builder &#x3D; new RouteBuilder() &#123;</span><br><span class="line">	public void configure() &#123;</span><br><span class="line">		from(&quot;queue:a&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(</span><br><span class="line">				&quot;queue:b&quot;);</span><br><span class="line">		from(&quot;queue:c&quot;).choice().when(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;))</span><br><span class="line">				.to(&quot;queue:d&quot;).when(header(&quot;foo&quot;).isEqualTo(&quot;cheese&quot;))</span><br><span class="line">				.to(&quot;queue:e&quot;).otherwise().to(&quot;queue:f&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CamelContext myCamelContext &#x3D; new DefaultCamelContext();</span><br><span class="line">myCamelContext.addRoutes(builder);</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">     xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">     xsi:schemaLocation&#x3D;&quot;</span><br><span class="line">     http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">     http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;spring http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;spring&#x2F;camel-spring.xsd</span><br><span class="line">  &quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- this is an included XML file where we only the the routeContext --&gt;</span><br><span class="line">  &lt;routeContext id&#x3D;&quot;myCoolRoutes&quot; xmlns&#x3D;&quot;http:&#x2F;&#x2F;camel.apache.org&#x2F;schema&#x2F;spring&quot;&gt;</span><br><span class="line">      &lt;!-- we can have a route --&gt;</span><br><span class="line">      &lt;route id&#x3D;&quot;cool&quot;&gt;</span><br><span class="line">          &lt;from uri&#x3D;&quot;direct:start&quot;&#x2F;&gt;</span><br><span class="line">          &lt;to uri&#x3D;&quot;mock:result&quot;&#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;route&gt;</span><br><span class="line">      &lt;!-- and another route, you can have as many your like --&gt;</span><br><span class="line">      &lt;route id&#x3D;&quot;bar&quot;&gt;</span><br><span class="line">          &lt;from uri&#x3D;&quot;direct:bar&quot;&#x2F;&gt;</span><br><span class="line">          &lt;to uri&#x3D;&quot;mock:bar&quot;&#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;route&gt;</span><br><span class="line">  &lt;&#x2F;routeContext&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<h1 id="FUSE-Mediation-Router-企业级Camel"><a href="#FUSE-Mediation-Router-企业级Camel" class="headerlink" title="FUSE Mediation Router: 企业级Camel"></a>FUSE Mediation Router: 企业级Camel</h1><p> FuseSource提供Camel的经测试、认证并提供支持的企业级版本，称作<a href="http://fusesource.com/products/enterprise-camel/" target="_blank" rel="noopener">FUSE Mediation Router</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/01/30/cli_design.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/01/30/cli_design.html" class="post-title-link" itemprop="url">命令行界面设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-01-30 00:00:00" itemprop="dateCreated datePublished" datetime="2014-01-30T00:00:00+08:00">2014-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">软件技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>尽管8年后的1973年出现了图形界面程序，
16年后的1981年出现了图形界面的操作系统，
但是在此之后，至今三十几年过去了，图形界面(GUI)仍无法取代命令行界面(CLI)。</code></pre><hr>
<h1 id="命令行界面是否过时"><a href="#命令行界面是否过时" class="headerlink" title="命令行界面是否过时"></a>命令行界面是否过时</h1><p>答案是：不会的！</p>
<p>1965年<a href="http://en.wikipedia.org/wiki/OS/360_and_successors" target="_blank" rel="noopener">OS/360</a>的发布标志着与硬件分离的“通用”操作系统的出现。</p>
<p>尽管8年后的1973年出现了<a href="http://en.wikipedia.org/wiki/Xerox_Alto" target="_blank" rel="noopener">图形界面程序</a>，<br>16年后的1981年出现了<a href="http://en.wikipedia.org/wiki/Xerox_Star" target="_blank" rel="noopener">图形界面的操作系统</a>，<br>但是在此之后，至今三十几年过去了，图形界面(GUI)仍无法取代命令行界面(CLI)。</p>
<p>有什么理由可以说，图形界面终将取代命令行界面呢？</p>
<p>不管是传统的linux“神器”，如find, grep, curl, netcat, xargs, rsync,<br>screen，awk, vi, emacs， 还是让人惊叹的新作，如maven, git,<br>salt，都有着强大的命令行界面。甚至你会有一种感觉：<br>为这些软件设计图形界面根本就是画蛇添足。</p>
<p>命令行界面的优势在于：</p>
<ul>
<li>效率高</li>
</ul>
<p>鼠标操作是最简单，同时也是最笨拙的操作</p>
<ul>
<li>更专注</li>
</ul>
<p>鼠标操作容易分心</p>
<ul>
<li>速度快</li>
</ul>
<p>CLI程序需要的资源少，启动和执行速度更快</p>
<ul>
<li>易远程</li>
</ul>
<p>ssh、telnet的连接比vnc、remote desktop等更容易</p>
<ul>
<li>自动化</li>
</ul>
<p>CLI不仅可以给人使用，也适用于自动化脚本</p>
<ul>
<li>zhuangbility</li>
</ul>
<p>^o^</p>
<h1 id="命令行界面的类型"><a href="#命令行界面的类型" class="headerlink" title="命令行界面的类型"></a>命令行界面的类型</h1><p>按照复杂程度，命令行界面可以分为：</p>
<ul>
<li>非交互式</li>
</ul>
<p>一次性输入所有的参数，程序执行期间不需要用户的干预。这是最常见的命令行界面形式。</p>
<ul>
<li>基于行的交互</li>
</ul>
<p>在执行过程中，需要用户输入一些内容，比如确认信息、路径参数等。</p>
<p>由于用户交互会使程序难以用于自动化脚本，所以这种命令行界面并不多见，常用于基于命令行的安装程序。</p>
<ul>
<li>文本用户界面(TUI)</li>
</ul>
<p>类似于图形用户界面，没有明确的执行流程，完全由用户控制程序的执行步骤。比如vi和emacs。</p>
<h1 id="CLI世界的潜规则"><a href="#CLI世界的潜规则" class="headerlink" title="CLI世界的潜规则"></a>CLI世界的潜规则</h1><p>为了使你的CLI程序不会显得格格不入，在设计CLI程序时要遵守一些潜规则。</p>
<ul>
<li><p>良好命名</p>
</li>
<li><p>容易理解</p>
</li>
<li><p>名字要短</p>
</li>
<li><p>容易记忆</p>
</li>
<li><p>必备选项</p>
</li>
</ul>
<p>所有的命令行工具都应该提供=-v/–version=和=-h/–help=选项。</p>
<ul>
<li>保持安静</li>
</ul>
<p>程序的输出要”恰到好处”，让用户/其他程序明确知道必要的信息，又不过分“啰嗦”。过多的输出即会浪费系统资源和带宽，也会让用户感觉不舒服，更重要的是会使得其他程序的处理逻辑变得复杂。以下的原则有利于保持安静：</p>
<ul>
<li><p>不要输出无关的信息，比如版本号、作者名——除非用户要求</p>
</li>
<li><p>对于很明确的结果，不需要再提醒用户。只应提示例外(exception)情况</p>
</li>
<li><p>不需要告诉用户输出的是什么东西——用户会知道的</p>
</li>
<li><p>如有必要，可以提供=-v/–verbose=和=-q/–quiet=选项，供用户选择</p>
</li>
<li><p>明确要求</p>
</li>
</ul>
<p>在基于行的交互式CLI中，需要用户输入时要给出明确的提示，比如：</p>
<p>=Do you really want to do this (y/n)?=</p>
<p>=Enter a date (YYYY-MM-DD):=</p>
<ul>
<li>支持管道</li>
</ul>
<p>程序应该支持从管道或文件重定向中读取数据：</p>
<ul>
<li><p>如果文件名作为参数传递给程序，就读取文件的内容作为输入</p>
</li>
<li><p>如果没有提供这样的参数，就从标准输入中读取，一直到 CTRL+D</p>
</li>
<li><p>功能单一</p>
</li>
</ul>
<p>UNIX哲学中重要的一条原则就是：每个程序只做一件事情，并把它做好。</p>
<p>复杂的功能通过程序间的配合完成，而为了与其他的程序配合，要尽量支持管道和重定向。</p>
<p>既然“只做一件事”，就要“做好一件事”。</p>
<ul>
<li>遵循惯例</li>
</ul>
<p>UNIX中命令行参数会有一些惯例，比如=-=后面的单字母选项可以连用（如=ls -Al=),<br>=–=后面使用多字母选项等；此外，遵循已经被广泛使用的命令的参数，也会容易被接受。</p>
<h1 id="CLI支持库"><a href="#CLI支持库" class="headerlink" title="CLI支持库"></a>CLI支持库</h1><p>CLI是如此重要，以至于很多语言/平台都提供了开发CLI的支持库，比如：</p>
<ul>
<li><p>python的optparse和argparse</p>
<p>argparse更先进，旨在替代optparse，但是从python2.7开始才支持。如果希望在比较旧的linux上运行(通常支持python2.4)，最好还是使用optparse。</p>
</li>
<li><p>java的Apache Commons CLI</p>
</li>
<li><p>Apache karaf的karaf-command-archetype</p>
</li>
</ul>
<h1 id="python的TUI支持库"><a href="#python的TUI支持库" class="headerlink" title="python的TUI支持库"></a>python的TUI支持库</h1><ul>
<li><a href="http://urwid.org/index.html" target="_blank" rel="noopener">Urwid</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2014/01/29/svn_install_config_and_mgnt.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/01/29/svn_install_config_and_mgnt.html" class="post-title-link" itemprop="url">subversion安装、配置和管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-01-29 00:00:00" itemprop="dateCreated datePublished" datetime="2014-01-29T00:00:00+08:00">2014-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-16 11:04:21" itemprop="dateModified" datetime="2018-04-16T11:04:21+08:00">2018-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">软件工程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>尽管svn已经被历史所抛弃，但同样由于历史原因，还要整理一下svn的配置文档。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2014/01/29/svn_install_config_and_mgnt.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Holbrook</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>















  

  


</body>
</html>
